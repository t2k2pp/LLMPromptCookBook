# レシピ1-3: 制約条件の明示的な指定

## 課題（Problem）
LLMは与えられた制約条件を暗黙的に理解または推測することができず、以下のような問題が発生します：

- パフォーマンス要件を満たさないコードの生成
- セキュリティ上の懸念がある実装の提案
- プロジェクト固有の規約に違反するコード
- スケーラビリティを考慮していない設計

## 解決方法（Solution）
制約条件を以下のカテゴリに分類し、明示的に指定します：

1. 機能的制約
2. 非機能要件
3. 技術的制約
4. コーディング規約
5. セキュリティ要件

## プロンプト例

### 制約条件を明示的に指定したプロンプト

```
あなたは、大規模なマイクロサービスアーキテクチャのバックエンドシステムを設計・実装するシニアソフトウェアアーキテクトです。

タスク：
Eコマースシステムの注文処理サービスのコア部分を実装してください。

制約条件：

【機能的制約】
1. べき等性の保証
   - 同一注文IDでの重複処理を防止
   - 冪等キーの有効期限は24時間

2. トランザクション管理
   - 分散トランザクションのサポート
   - 補償トランザクションの実装

3. データ整合性
   - 在庫データとの整合性確保
   - 注文状態の一貫性維持

【非機能要件】
1. パフォーマンス
   - レイテンシ: 99パーセンタイルで200ms以下
   - スループット: 1000 TPS以上
   - 同時接続数: 最大10,000セッション

2. 可用性
   - SLA: 99.99%
   - フェイルオーバー時間: 10秒以内
   - リージョン間レプリケーション

3. スケーラビリティ
   - 水平スケーリング対応
   - ステートレス設計
   - キャッシュ戦略の実装

【技術的制約】
1. 使用技術
   - 言語: TypeScript 5.0
   - フレームワーク: NestJS 10.x
   - データベース: MongoDB 6.0
   - メッセージブローカー: Apache Kafka 3.5

2. アーキテクチャ
   - イベント駆動アーキテクチャ
   - CQRS パターンの採用
   - DDD原則の遵守

3. 監視・運用
   - OpenTelemetryによる分散トレーシング
   - Prometheusメトリクス対応
   - 構造化ログ出力

【コーディング規約】
1. コード品質
   - Sonar Qualityゲート: AランクまたはSランク
   - テストカバレッジ: 85%以上
   - 循環的複雑度: 10未満

2. 命名規則
   - インターフェース: 'I'プレフィックス
   - 実装クラス: 具象的な名詞
   - メソッド: 動詞 + 名詞

3. エラー処理
   - カスタム例外クラスの使用
   - エラーコードの標準化
   - 詳細なエラーログ

【セキュリティ要件】
1. 認証・認可
   - JWTベースの認証
   - ロールベースのアクセス制御
   - トークンの有効期限管理

2. データ保護
   - 機密情報の暗号化
   - PII データの匿名化
   - 監査ログの保存

3. セキュリティ対策
   - 入力バリデーション
   - SQLインジェクション対策
   - レートリミッティング

期待する出力：
1. 主要なインターフェースとクラスの実装
2. エラーハンドリングの実装
3. テストケースのサンプル
```

## 制約条件の指定パターン

### 1. 定量的な制約

パフォーマンスやスケーラビリティに関する制約は、具体的な数値で指定します：